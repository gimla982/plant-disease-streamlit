# -*- coding: utf-8 -*-
"""Untitled54.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1RWA8OUpgqoj7nK8QUH7FVLB7YyZGSRou
"""

# app.py
import streamlit as st
import numpy as np
from PIL import Image
import tensorflow as tf
import json

st.set_page_config(page_title="ğŸƒ Plant Health Checker", page_icon="ğŸŒ±", layout="centered")
st.title("ğŸŒ± Plant Doctor â€“ ××‘×—×•×Ÿ ××—×œ×•×ª ×‘×¢×œ×™×")
st.markdown("**×”×¢×œ×” ×ª××•× ×” ×©×œ ×¢×œ×”, ×•×§×‘×œ ××‘×—×•×Ÿ ××”×™×¨: ×‘×¨×™× ××• ×—×•×œ×”, ×›×•×œ×œ ×˜×™×¤×•×œ ğŸ§ª**")

# âœ… ×˜×¢×™× ×ª ×”××•×“×œ ×”×××•××Ÿ
@st.cache_resource
def load_model():
    return tf.keras.models.load_model("mobilenetv2_plant_disease_model.h5")

model = load_model()

# âœ… ×ª×•×•×™×•×ª ×”××—×œ×§×•×ª (×‘××•×ª×• ×¡×“×¨ ×‘×• ××•××Ÿ ×”××•×“×œ!)
CLASS_LABELS = [
    "Healthy",
    "Tomato___Early_blight",
    "Tomato___Late_blight",
    "Tomato___Leaf_Mold",
    "Tomato___Septoria_leaf_spot",
    "Tomato___Spider_mites",
    "Tomato___Target_Spot",
    "Tomato___Tomato_Yellow_Leaf_Curl_Virus"
]

# âœ… ×”××œ×¦×•×ª ×˜×™×¤×•×œ ×œ×¤×™ ×¡×•×’ ×”××—×œ×”
TREATMENTS = {
    "Tomato___Early_blight": "ğŸŒ± ×”×¡×¨ ×¢×œ×™× ×—×•×œ×™× ×•×”×©×ª××© ×‘×§×•×˜×œ ×¤×˜×¨×™×•×ª ××‘×•×¡×¡ × ×—×•×©×ª.",
    "Tomato___Late_blight": "ğŸŒ§ï¸ ××œ ×ª×©×§×” ×¢×œ×™× ×™×©×™×¨×•×ª. ×¨×¡×¡ ×‘×§×•×˜×œ ×¤×˜×¨×™×•×ª ××¢×¨×›×ª×™.",
    "Tomato___Leaf_Mold": "ğŸ’¨ ××•×•×¨×•×¨ ××•×’×‘×¨ ×‘×—×××”. ×¨×¡×¡ ×‘×§×•×˜×œ ×˜×‘×¢×™.",
    "Tomato___Septoria_leaf_spot": "ğŸ•’ ×”×©×§×™×” ×‘×©×¢×•×ª ×‘×•×§×¨ ×‘×œ×‘×“. ×”×¡×¨ ×¢×œ×™× × ×’×•×¢×™×.",
    "Tomato___Spider_mites": "ğŸ•·ï¸ ×”×©×ª××© ×‘×©××Ÿ × ×™× ××• ×¡×‘×•×Ÿ ×—×¨×§×™×.",
    "Tomato___Target_Spot": "ğŸ’‰ ×¨×¡×¡ ×‘×ª×›×©×™×¨ ×§×•×˜×œ ×¤×˜×¨×™×•×ª ×¡×™×¡×˜××™.",
    "Tomato___Tomato_Yellow_Leaf_Curl_Virus": "ğŸš« ××™×Ÿ ×˜×™×¤×•×œ. ××•××œ×¥ ×œ×”×¡×™×¨ ××ª ×”×¦××— ×•×œ×× ×•×¢ ×”×ª×¤×©×˜×•×ª.",
}

# âœ… ×”×¢×œ××ª ×ª××•× ×”
uploaded_file = st.file_uploader("ğŸ“¸ ×”×¢×œ×” ×ª××•× ×” ×©×œ ×”×¢×œ×” ×©×œ×š", type=["jpg", "jpeg", "png"])

if uploaded_file:
    image = Image.open(uploaded_file).convert('RGB')
    st.image(image, caption="ğŸ“· ×ª××•× ×” ×©× ×˜×¢× ×”", use_column_width=True)

    # ×¢×™×‘×•×“ ×”×ª××•× ×”
    img = image.resize((224, 224))
    img_array = np.array(img) / 255.0
    img_batch = np.expand_dims(img_array, axis=0)

    # × ×™×‘×•×™
    prediction = model.predict(img_batch)
    predicted_index = np.argmax(prediction)
    predicted_label = CLASS_LABELS[predicted_index]
    confidence = prediction[0][predicted_index]

    st.markdown("---")
    st.subheader("ğŸ” ×ª×•×¦××”:")

    if predicted_label == "Healthy":
        st.success(f"âœ… ×”×¢×œ×” ×‘×¨×™×! ({confidence*100:.1f}% ×‘×™×˜×—×•×Ÿ)")
        st.balloons()
    else:
        st.error(f"âš ï¸ ×”×¢×œ×” ×—×•×œ×”: **{predicted_label}** ({confidence*100:.1f}% ×‘×™×˜×—×•×Ÿ)")
        st.markdown(f"ğŸ’¡ **×”××œ×¦×” ×œ×˜×™×¤×•×œ:** {TREATMENTS.get(predicted_label, 'ğŸ§¾ ×× × ×”×ª×™×™×¢×¥ ×¢× ××•××—×”.')}")